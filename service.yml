name: gateway-images
lang: python
lang_version: 3.12
git:
  enable: true
codeowners:
  enable: true
semaphore:
  enable: true
  pipeline_type: cp-dockerfile
  pipeline_enable: false
  docker_repos: ["confluentinc/cpc-gateway", "confluentinc/confluent-gateway-for-cloud"]
  maven_phase: 'package'
  maven_skip_deploy: true
  build_arm: true
  sign_images: true
  os_types: ["ubi9"]
  nano_version: true
  use_packages: true
  cp_images: true
  push_latest: true
  tasks:
    - name: cp-dockerfile-build
      branch: master
      pipeline_file: .semaphore/cp_dockerfile_build.yml
      parameters:
        - name: GATEWAY_VERSION
          required: true
        - name: PACKAGES_URL
          required: true
        - name: PACKAGES_MAVEN_URL
          required: true
        - name: PACKAGING_BUILD_NUMBER
          required: true
        - name: ALLOW_UNSIGNED
          required: true
          default_value: 'False'
          options:
            - 'True'
            - 'False'
    - name: cp-dockerfile-promote
      branch: master
      pipeline_file: .semaphore/cp_dockerfile_promote.yml
      parameters:
        - name: GATEWAY_VERSION
          required: true
        - name: IMAGE_REVISION
          required: true
          default_value: '1'
        - name: UPDATE_LATEST_TAG
          required: true
        - name: PACKAGING_BUILD_NUMBER
          required: true
        - name: PROMOTE_OS_TYPE
          required: true
          options:
            - 'ubi'
    - name: version-compatibility-tests
      branch: master
      at: "0 21 * * 0"    # Sun at 21:00 UTC
      pipeline_file: .semaphore/version_compatibility_tests.yml
      parameters:
        - name: KAFKA_SERVER_VERSION
          required: false
          description: "Kafka server version to test against, e.g., 8.0.0"
        - name: KAFKA_CLIENT_VERSION
          required: false
          description: "Kafka client version to test against, e.g., 8.0.0"
code_artifact:
  enable: true
  package_paths:
    - maven-snapshots/maven/io.confluent/cpc-gateway-images
    - maven-snapshots/maven/io.confluent/cpc-gateway-images-parent
    - maven-snapshots/maven/io.confluent.cpc-gateway-images/cpc-gateway-images-parent
    - maven-snapshots/maven/io.confluent.cpc-gateway-images/cpc-gateway  
    - maven-snapshots/maven/io.confluent.cpc-gateway-images/confluent-gateway-for-cloud
